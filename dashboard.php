<?php
// require './Backend/auth_guard.php';
include './Backend/config.php';

// Count blocks
$result_blocks = mysqli_query($conn, "SELECT COUNT(*) as Block_count FROM blocks");
$row_blocks = mysqli_fetch_assoc($result_blocks);
$block_count = $row_blocks['Block_count'] ?? 0;

// Count faculty
$result_faculty = mysqli_query($conn, "SELECT COUNT(*) as Faculty_count FROM faculty");
$row_faculty = mysqli_fetch_assoc($result_faculty);
$faculty_count = $row_faculty['Faculty_count'] ?? 0;
?>
<div class="animate-fadeIn">
    <div class="count-bar">
        <div class="count-container">
            <div class="identity">
                <svg width="35" height="35" viewBox="0 0 53 53" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M26.5 12.1458C28.5499 12.1458 30.5158 12.9602 31.9653 14.4097C33.4148 15.8592 34.2292 17.8251 34.2292 19.875C34.2292 21.9249 33.4148 23.8909 31.9653 25.3404C30.5158 26.7899 28.5499 27.6042 26.5 27.6042C24.4501 27.6042 22.4842 26.7899 21.0347 25.3404C19.5852 23.8909 18.7708 21.9249 18.7708 19.875C18.7708 17.8251 19.5852 15.8592 21.0347 14.4097C22.4842 12.9602 24.4501 12.1458 26.5 12.1458ZM11.0417 17.6667C12.2783 17.6667 13.4267 17.9979 14.4204 18.5942C14.0892 21.7521 15.0167 24.8879 16.9158 27.3392C15.8117 29.4592 13.6033 30.9167 11.0417 30.9167C9.28461 30.9167 7.59951 30.2187 6.35708 28.9763C5.11466 27.7338 4.41667 26.0487 4.41667 24.2917C4.41667 22.5346 5.11466 20.8495 6.35708 19.6071C7.59951 18.3647 9.28461 17.6667 11.0417 17.6667ZM41.9583 17.6667C43.7154 17.6667 45.4005 18.3647 46.6429 19.6071C47.8853 20.8495 48.5833 22.5346 48.5833 24.2917C48.5833 26.0487 47.8853 27.7338 46.6429 28.9763C45.4005 30.2187 43.7154 30.9167 41.9583 30.9167C39.3967 30.9167 37.1883 29.4592 36.0842 27.3392C38.0087 24.8531 38.9023 21.7215 38.5796 18.5942C39.5733 17.9979 40.7217 17.6667 41.9583 17.6667ZM12.1458 40.3021C12.1458 35.7308 18.5721 32.0208 26.5 32.0208C34.4279 32.0208 40.8542 35.7308 40.8542 40.3021V44.1667H12.1458V40.3021ZM0 44.1667V40.8542C0 37.7846 4.17375 35.2008 9.82708 34.45C8.52417 35.9517 7.72917 38.0275 7.72917 40.3021V44.1667H0ZM53 44.1667H45.2708V40.3021C45.2708 38.0275 44.4758 35.9517 43.1729 34.45C48.8262 35.2008 53 37.7846 53 40.8542V44.1667Z" fill="white"/>
                </svg>
            </div>
            <div class="count-txt">
                <div class="count"><?php echo $faculty_count; ?></div>
                <div class="c-text">Total Staff</div>
            </div>
        </div>
        <div class="count-container">
            <div class="identity">
                <svg width="35" height="35" viewBox="0 0 53 53" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M23.4039 4.43874L43.2789 8.85541C43.5291 8.90542 43.7543 9.04055 43.9161 9.23782C44.078 9.4351 44.1665 9.68233 44.1666 9.9375V43.0625C44.1665 43.3177 44.078 43.5649 43.9161 43.7622C43.7543 43.9594 43.5291 44.0946 43.2789 44.1446L23.4039 48.5612C23.2438 48.5933 23.0785 48.5893 22.9201 48.5498C22.7617 48.5103 22.614 48.4361 22.4877 48.3326C22.3613 48.2291 22.2596 48.0988 22.1896 47.9513C22.1197 47.8037 22.0834 47.6425 22.0833 47.4792V5.52083C22.0834 5.35753 22.1197 5.19629 22.1896 5.04872C22.2596 4.90115 22.3613 4.77092 22.4877 4.66743C22.614 4.56393 22.7617 4.48974 22.9201 4.45019C23.0785 4.41065 23.2438 4.40674 23.4039 4.43874ZM19.875 8.83333V44.1667H10.4896C10.0893 44.1666 9.70264 44.0217 9.40101 43.7586C9.09938 43.4956 8.9032 43.1322 8.84877 42.7357L8.83331 42.5104V10.4896C8.83333 10.0893 8.97827 9.70266 9.24134 9.40102C9.50441 9.09939 9.8678 8.90322 10.2643 8.84879L10.4896 8.83333H19.875ZM28.7083 24.2917C28.1226 24.2917 27.5609 24.5243 27.1468 24.9385C26.7326 25.3526 26.5 25.9143 26.5 26.5C26.5 27.0857 26.7326 27.6474 27.1468 28.0615C27.5609 28.4757 28.1226 28.7083 28.7083 28.7083C29.294 28.7083 29.8557 28.4757 30.2698 28.0615C30.684 27.6474 30.9166 27.0857 30.9166 26.5C30.9166 25.9143 30.684 25.3526 30.2698 24.9385C29.8557 24.5243 29.294 24.2917 28.7083 24.2917Z" fill="white"/>
                </svg>
            </div>
            <div class="count-txt">
                <div class="count"><?php echo $block_count; ?></div>
                <div class="c-text">Total Blocks</div>
            </div>
        </div>
    </div>

    <div class="history-list">
        <div class="block-data">
            <div>#</div>
            <div>Schedule Name</div>
            <div>Type</div>
            <div>Timestamp</div>
            <div>Action</div>
        </div>
        <?php
        $schedule_result = mysqli_query($conn, "SELECT * FROM schedule ORDER BY created_at DESC LIMIT 5");
        $count = 1;
        
        if(mysqli_num_rows($schedule_result) > 0) {
            while($schedule_row = mysqli_fetch_assoc($schedule_result)) {
                $status_class = $schedule_row['status'] ?? 'active';
                echo '<div class="block-data block-serial" onclick="go_to_schedule(\''.$schedule_row['id'].'\')" data-id="'.$schedule_row['id'].'">
                    <div class="blk-no">'.$count.'</div>
                    <div class="courses">
                        <div class="c-list">'.$schedule_row['task_name'].'</div>
                    </div>
                    <div class="date">'.$schedule_row['task_type'].'</div>
                    <div class="time">'.date('M d, Y H:i', strtotime($schedule_row['created_at'])).'</div>
                    <div class="delete" onclick="deleteSchedule(event,\''.$schedule_row['id'].'\')" title="Delete Schedule">
                        <svg width="20" height="20" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M30.482 7.442L31.068 11.5H39C39.3978 11.5 39.7794 11.658 40.0607 11.9393C40.342 12.2206 40.5 12.6022 40.5 13C40.5 13.3978 40.342 13.7794 40.0607 14.0607C39.7794 14.342 39.3978 14.5 39 14.5H37.462L35.716 34.87C35.61 36.11 35.524 37.13 35.386 37.954C35.246 38.812 35.032 39.58 34.614 40.292C33.9576 41.4103 32.9818 42.3067 31.812 42.866C31.068 43.22 30.284 43.366 29.416 43.434C28.582 43.5 27.56 43.5 26.316 43.5H21.684C20.44 43.5 19.418 43.5 18.584 43.434C17.716 43.366 16.932 43.22 16.188 42.866C15.0182 42.3067 14.0424 41.4103 13.386 40.292C12.966 39.58 12.756 38.812 12.614 37.954C12.476 37.128 12.39 36.11 12.284 34.87L10.538 14.5H9C8.60218 14.5 8.22064 14.342 7.93934 14.0607C7.65804 13.7794 7.5 13.3978 7.5 13C7.5 12.6022 7.65804 12.2206 7.93934 11.9393C8.22064 11.658 8.60218 11.5 9 11.5H16.932L17.518 7.442L17.54 7.32C17.904 5.74 19.26 4.5 20.96 4.5H27.04C28.74 4.5 30.096 5.74 30.46 7.32L30.482 7.442ZM19.962 11.5H28.036L27.524 7.948C27.428 7.614 27.184 7.5 27.038 7.5H20.962C20.816 7.5 20.572 7.614 20.476 7.948L19.962 11.5ZM22.5 21C22.5 20.6022 22.342 20.2206 22.0607 19.9393C21.7794 19.658 21.3978 19.5 21 19.5C20.6022 19.5 20.2206 19.658 19.9393 19.9393C19.658 20.2206 19.5 20.6022 19.5 21V31C19.5 31.3978 19.658 31.7794 19.9393 32.0607C20.2206 32.342 20.6022 32.5 21 32.5C21.3978 32.5 21.7794 32.342 22.0607 32.0607C22.342 31.7794 22.5 31.3978 22.5 31V21ZM28.5 21C28.5 20.6022 28.342 20.2206 28.0607 19.9393C27.7794 19.658 27.3978 19.5 27 19.5C26.6022 19.5 26.2206 19.658 25.9393 19.9393C25.658 20.2206 25.5 20.6022 25.5 21V31C25.5 31.3978 25.658 31.7794 25.9393 32.0607C26.2206 32.342 26.6022 32.5 27 32.5C27.3978 32.5 27.7794 32.342 28.0607 32.0607C28.342 31.7794 28.5 31.3978 28.5 31V21Z" fill="currentColor"/>
                        </svg>
                    </div>
                </div>';
                $count++;
            }
        } else {
            echo '<div class="block-data">
                <div colspan="5" style="text-align: center; padding: 40px; color: #64748b;">
                    No schedules found. Create your first schedule!
                </div>
            </div>';
        }
        ?>
    </div>
</div>